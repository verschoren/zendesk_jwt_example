<script>
  function Logout(){
        console.log("user logged out");
        zE(function () {
            zE.logout();
        });

        zE('webWidget', 'prefill', {
            name: {
                value: '',
                readOnly: false
            },
            email: {
                value: '',
                readOnly: false
            }
        });
    }

    function Login(){
        var user = {
            name: $('#name').val(),
            email: $('#email').val(),
            external_id: $('#external_id').val()
        }        
        console.log("User logged in", user);

        //get token for current user
        var jwttoken = '';
        $.ajax({
            type: "POST",
            url: 'https://jwt-demo.verschoren.workers.dev/guide',
            data: JSON.stringify({ "external_id": user.external_id, "user_email": user.email, "user_name": user.name }),
            dataType: 'text',
            async: false,
            success: function (json) {
                jwttoken = json;
                $('#login_ok').show();
            }
        });
        console.log(jwttoken)

        //Prefill Forms and Chat
        zE('webWidget', 'identify', {
            name: user.name,
            email: user.email,
        });

        zE('webWidget', 'prefill', {
            name: {
                value: user.name,
                readOnly: true
            },
            email: {
                value: user.email,
                readOnly: true
            }
        });

        //Authenticate
        window.zESettings = {
            webWidget: {
                authenticate: {
                    jwtFn: function (callback) {
                        callback(jwttoken);
                    }
                }
            }
        }
    }
</script>
